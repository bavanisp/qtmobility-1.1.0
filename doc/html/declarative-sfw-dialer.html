<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- declarative-sfw-dialer.qdoc -->
  <title>Qt Mobility 1.1: Service Framework using QML Example</title>
  <link rel="stylesheet" type="text/css" href="style/style.css"
 />  <!--[if IE]>
<meta name="MSSmartTagsPreventParsing" content="true">
<meta http-equiv="imagetoolbar" content="no">
<![endif]-->
<!--[if lt IE 7]>
<link rel="stylesheet" type="text/css" href="style/style_ie6.css">
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" type="text/css" href="style/style_ie7.css">
<![endif]-->
<!--[if IE 8]>
<link rel="stylesheet" type="text/css" href="style/style_ie8.css">
<![endif]-->
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
 <script src="./scripts/superfish.js" type="text/javascript"></script>
 <script src="./scripts/narrow.js" type="text/javascript"></script>
  <link rel="stylesheet" type="text/css" href="style/superfish.css" />  <link rel="stylesheet" type="text/css" href="style/narrow.css" /></head>
<body class="" onload="CheckEmptyAndLoadList();">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Mobility Reference Documentation</span></a>
		<div id="narrowsearch"><form onsubmit="return false;" action="" id="qtdocsearchTop">
		<fieldset>
		<input type="text" value="" id="pageType2" name="searchstring"/>
		 </fieldset>
		</form></div>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://developer.qt.nokia.com/">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Mobility 1.1</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://doc.qt.nokia.com">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu sf-js-enabled sf-shadow" id="narrowmenu"> 
		 <li><a href="#">API Lookup</a> 
			 <ul id="topmenuLook"> 
			   <li><a href="classes.html">Class index</a></li> 
 			  <li><a href="functions.html">Function index</a></li> 
			   <li><a href="modules.html">Modules</a></li> 
			   </ul> 
		 </li> 
		 <li><a href="#">Examples</a> 
			 <ul id="topmenuexample"> 
				 <li><a href="all-examples.html">Examples</a></li> 
			 </ul> 
		 </li> 
 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="index.html#platform-compatibility">Platform Compatibility</a></li>
              <li class="defaultLink"><a href="qml-plugins.html">QML Plugins</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
              <li class="defaultLink"><a href="http://doc.qt.nokia.com/4.7-snapshot/">Qt 4.7</a></li>
              <li class="defaultLink"><a href="http://doc.qt.nokia.com/4.7-snapshot/qt-basic-concepts.html">Basic Qt architecture</a></li>
              <li class="defaultLink"><a href="http://doc.qt.nokia.com/4.7-snapshot/declarativeui.html">Device UI's &amp; Qt Quick</a></li>
              <li class="defaultLink"><a href="http://doc.qt.nokia.com/4.7-snapshot/qt-gui-concepts.html">Desktop UI components</a></li>
              <li class="defaultLink"><a href="http://doc.qt.nokia.com/4.7-snapshot/platform-specific.html">Platform-specific info</a></li>
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
              <li><a href="all-examples.html">Examples</a></li>              <li><a href="examples-declarative-sfw-dialer.html"></a></li>              <li>Service Framework using QML Example</li>            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
          </div>
        </div>
        <div class="content">
<h1 class="title">Service Framework using QML Example</h1>
<span class="subtitle"></span>
<div class="descr"/>
<p>Files:</p>
<ul>
<li><a href="declarative-sfw-dialer-declarative-sfw-dialer-declarative-sfw-dialer-qml.html">declarative-sfw-dialer/declarative-sfw-dialer/declarative-sfw-dialer.qml</a></li>
<li><a href="declarative-sfw-dialer-declarative-sfw-dialer-qmldialer-cpp.html">declarative-sfw-dialer/declarative-sfw-dialer/qmldialer.cpp</a></li>
<li><a href="declarative-sfw-dialer-declarative-sfw-dialer-content-sfw-dialer-dialbutton-qml.html">declarative-sfw-dialer/declarative-sfw-dialer/content-sfw-dialer/DialButton.qml</a></li>
<li><a href="declarative-sfw-dialer-declarative-sfw-dialer-content-sfw-dialer-dialscreen-qml.html">declarative-sfw-dialer/declarative-sfw-dialer/content-sfw-dialer/DialScreen.qml</a></li>
<li><a href="declarative-sfw-dialer-declarative-sfw-dialer-content-sfw-dialer-dialerlist-qml.html">declarative-sfw-dialer/declarative-sfw-dialer/content-sfw-dialer/DialerList.qml</a></li>
<li><a href="declarative-sfw-dialer-landlinedialer-landlinedialer-cpp.html">declarative-sfw-dialer/landlinedialer/landlinedialer.cpp</a></li>
<li><a href="declarative-sfw-dialer-landlinedialer-landlinedialer-h.html">declarative-sfw-dialer/landlinedialer/landlinedialer.h</a></li>
<li><a href="declarative-sfw-dialer-landlinedialer-landlinedialerplugin-cpp.html">declarative-sfw-dialer/landlinedialer/landlinedialerplugin.cpp</a></li>
<li><a href="declarative-sfw-dialer-landlinedialer-landlinedialerplugin-h.html">declarative-sfw-dialer/landlinedialer/landlinedialerplugin.h</a></li>
<li><a href="declarative-sfw-dialer-landlinedialer-landlinedialerservice-xml.html">declarative-sfw-dialer/landlinedialer/landlinedialerservice.xml</a></li>
<li><a href="declarative-sfw-dialer-remotedialer-remotedialer-cpp.html">declarative-sfw-dialer/remotedialer/remotedialer.cpp</a></li>
<li><a href="declarative-sfw-dialer-remotedialer-remotedialer-h.html">declarative-sfw-dialer/remotedialer/remotedialer.h</a></li>
<li><a href="declarative-sfw-dialer-remotedialer-remotedialerservice-xml.html">declarative-sfw-dialer/remotedialer/remotedialerservice.xml</a></li>
<li><a href="declarative-sfw-dialer-voipdialer-voipdialer-cpp.html">declarative-sfw-dialer/voipdialer/voipdialer.cpp</a></li>
<li><a href="declarative-sfw-dialer-voipdialer-voipdialer-h.html">declarative-sfw-dialer/voipdialer/voipdialer.h</a></li>
<li><a href="declarative-sfw-dialer-voipdialer-voipdialerplugin-cpp.html">declarative-sfw-dialer/voipdialer/voipdialerplugin.cpp</a></li>
<li><a href="declarative-sfw-dialer-voipdialer-voipdialerplugin-h.html">declarative-sfw-dialer/voipdialer/voipdialerplugin.h</a></li>
<li><a href="declarative-sfw-dialer-voipdialer-voipdialerservice-xml.html">declarative-sfw-dialer/voipdialer/voipdialerservice.xml</a></li>
<li><a href="declarative-sfw-dialer-remotedialer-main-cpp.html">declarative-sfw-dialer/remotedialer/main.cpp</a></li>
<li><a href="declarative-sfw-dialer-declarative-sfw-dialer-pro.html">declarative-sfw-dialer/declarative-sfw-dialer.pro</a></li>
<li><a href="declarative-sfw-dialer-declarative-sfw-dialer-declarative-sfw-dialer-pro.html">declarative-sfw-dialer/declarative-sfw-dialer/declarative-sfw-dialer.pro</a></li>
<li><a href="declarative-sfw-dialer-declarative-sfw-dialer-content-sfw-dialer-qmldir.html">declarative-sfw-dialer/declarative-sfw-dialer/content-sfw-dialer/qmldir</a></li>
<li><a href="declarative-sfw-dialer-landlinedialer-landlinedialer-pro.html">declarative-sfw-dialer/landlinedialer/landlinedialer.pro</a></li>
<li><a href="declarative-sfw-dialer-remotedialer-remotedialer-pro.html">declarative-sfw-dialer/remotedialer/remotedialer.pro</a></li>
<li><a href="declarative-sfw-dialer-voipdialer-voipdialer-pro.html">declarative-sfw-dialer/voipdialer/voipdialer.pro</a></li>
</ul>
<p><b>Execution</b></p>
<p>This example requires the example dialer services to be pre-registered in order for the application to discover and load the services. This can be done by using the service framework command line tool to add the corresponding service XML file:</p>
<ul>
<li>./servicefw add voipdialerservice.xml</li>
<li>./servicefw add landlinedialerservice.xml</li>
</ul>
<p>There are 2 ways to run the example:</p>
<ul>
<li>./qmldialer (only method for Symbian)</li>
<li>qmldialer declarative-sfw-dialer.qml</li>
</ul>
<p>The XML files for all example services can be found in the QtMobility build directory under install/bin/xmldata</p>
<p><b>Explanation</b></p>
<p>This example should demonstrate how to use the Service Framework to access a list of services in a QML context. A library plugin provides QML with elements that can reference a single service or a list of services, called 'Service' and '<a href="qml-servicelist.html">ServiceList</a>' respectively.</p>
<p>An example that demonstrates how to connect to a single service object to implement a simple note taking application can be found <a href="declarative-sfw-notes.html">here</a>.</p>
<a name="guidesign"></a><p>The GUI looks like following picture:</p>
<p class="centerAlign"><img src="images/DialerServiceGUI.png" alt="&quot;GUI&quot;" /></p><p>The following steps outline how to make a QML based application using the Service Framework technology. It is assumed that Qt Mobility has been successfully built and environment variables have been set as per <a href="installation.html">Installation Guide</a>.</p>
<p><b>Service Framework in QML:</b></p>
<p>To included the Service Framework QML plugin to our QML file we need to import it as follows:</p>
<pre class="highlightedCode brush: cpp"> import QtMobility.serviceframework 1.1</pre>
<p><b>The Services:</b></p>
<p>The services are implemented in a shared library and can be register in the service framework. After the service is registered it can be used in different applications. In our case we'll access the services over an application that is based on QML scripting. We will be able to change between different services and call their properties, receiving their signals and so forth.</p>
<p>In this example we've implemented 2 services called Landdialer and Voipdialer. You can find the projects for those services in:</p>
<p>declarative-sfw-dialer\landlinedialer and declarative-sfw-dialer\voipdialer. Those projects will create a shared library in each case.</p>
<p>If the library needs to be available over the Service Framework, we need to register the library. In our example this will be done manually by using the servicefw tool. Refer to the project README for further details.</p>
<p>As you can see we register the services using a xml file. This xml file basically contains all information to register the shared library in the Service Framework environment. For more information please read more about the Qt Service Framework <a href="service-frameworks.html#adding-and-removing-of-services">XML Format</a></p>
<p>The <a href="qservicemanager.html">QServiceManager</a> creates an instance of a services over a <a href="qserviceplugininterface.html">QServicePluginInterface</a>. For each services we provide a Plugin.</p>
<pre class="highlightedCode brush: cpp"> class VoipDialerPlugin : public QObject,
                                 public QServicePluginInterface
 {
     Q_OBJECT
     Q_INTERFACES(QtMobility::QServicePluginInterface)</pre>
<p>The Q_INTERFACES macro tells Qt which interfaces the class implements.</p>
<p>Both seviceplugins needs to implement the <a href="qserviceplugininterface.html">QServicePluginInterface</a>. In our case we only need to overwrite the virtual function createInstance.</p>
<pre class="highlightedCode brush: cpp"> QObject* VoipDialerPlugin::createInstance(const QServiceInterfaceDescriptor&amp; descriptor, QServiceContext* context, QAbstractSecuritySession* session)
 {
     Q_UNUSED(descriptor);
     Q_UNUSED(context);
     Q_UNUSED(session);
     return new VoipDialer(this);
 }

 Q_EXPORT_PLUGIN2(serviceframework_voipdialerservice, VoipDialerPlugin)</pre>
<p>As you can see the createInstance function create the appropriate dialer object and returns it. The Q_EXPORT_PLUGIN2 macro provides the necessary implementation for a plugin. See <a href="http://qt.nokia.com/doc/4.6/plugins-howto.html">How to Create Qt Plugins</a> for more details.</p>
<p>The last thing we need to provide in our services are the states, properties, signals and slots that we want to access in out QML script later.</p>
<a name="voipdialer-h-0"></a><pre class="highlightedCode brush: cpp"> public:
     enum ConnectionState {
         Disconnected = 0,
         Connecting,
         Connected,
         Engaged
     };
     Q_PROPERTY( ConnectionState state READ state NOTIFY stateChanged);
     ConnectionState state() const;

 public slots:
     void dialNumber(const QString&amp; number);
     void hangup();

 signals:
     void stateChanged();</pre>
<p><b>Service access on the QML site</b></p>
<p>The QML elements are implemented in 4 different qml scripting files <a href="#guidesign"> see GUI design</a>.</p>
<p>The first step is to use our ServiceWrapperList to specify the interface and minimum version (optional) through QML item context, which will produce a list of ServiceWrapper objects.</p>
<pre class="highlightedCode brush: cpp">     ServiceList {
         id: dialerServiceList
         interfaceName: &quot;com.nokia.qt.examples.Dialer&quot;
         majorVersion: 1
         minorVersion: 0
     }</pre>
<p>In the DialerList.qml file the services property is assigned to the ListView model property.</p>
<pre class="highlightedCode brush: cpp">         ListView {
             id: serviceListView
             height: mainPage.height * 4/10
             width: mainPage.width - dialScreen.width - 26
             anchors.topMargin: 5
             anchors.leftMargin: 5
             anchors.rightMargin: 5
             model: dialerServiceList.services
             opacity: 1
             delegate: delegate
             currentIndex: -1
             clip: true
         }</pre>
<p>To show the items of the model property we need to create a delegate component and assign it to the ListView Delegate property:</p>
<pre class="highlightedCode brush: cpp">         Component {
             id: delegate</pre>
<p>In this component you can define how you want to draw one ListView item. You can access inside of this component the current ListWiew item by using the variable modelData. In our example we are using two text lines. Furthermore we can define whats happening if we click on a ListView item by using the MouseRegion.</p>
<a name="dialerlist-qml-2"></a><pre class="highlightedCode brush: cpp">                 MouseArea {
                     id: listItemMouseRegion
                     anchors.fill: parent
                     onClicked: {
                         if(listFrame.nohighlightlistitem){
                             serviceListView.highlight = highlight
                             listFrame.nohighlightlistitem = false;
                         }
                         serviceListView.currentIndex = index;
                         dialService = model.modelData;
                         signalSelected()
                     }
                 }

                 Text {
                     id: serviceItemInfo
                     anchors.top: parent.top
                     anchors.left: parent.left
                     anchors.topMargin: 5
                     anchors.leftMargin: 3
                     text: &quot; &lt;b&gt;Service:&lt;/b&gt; &quot; + serviceName + &quot;  (&quot; +
                                                 majorVersion + &quot;.&quot; +
                                                 minorVersion + &quot;)&quot;
                 }

                 Text {
                     id: serviceItemInterfaceName
                     anchors.top: serviceItemInfo.bottom
                     anchors.left: parent.left
                     anchors.topMargin: 2
                     anchors.leftMargin: 3
                     text: &quot; &lt;b&gt;Interface:&lt;/b&gt; &quot; + interfaceName;
                 }</pre>
<p>Another component can be created for highliting a list item:</p>
<pre class="highlightedCode brush: cpp">         Component {
             id: highlight

             Rectangle {
                 width: childrenRect.width
                 border.color: &quot;black&quot;; border.width: 2
                 height: 30
                 color : &quot;lightsteelblue&quot;
                 gradient: Gradient {
                     GradientStop {position: 0.0; color: &quot;steelblue&quot;}
                     GradientStop {position: 0.5; color: &quot;lightsteelblue&quot;}
                     GradientStop {position: 1.0; color: &quot;steelblue&quot;}
                 }
             }
         }</pre>
<p><b>Service signals and function calls on the QML site</b></p>
<p>In sfw-kinetic-example.qml we define a control named DialScreen and implement the function onDial and onHangup. As you can see in the onDial event we call the service function dialNumber and the onHangup calls hangup. Both function are implemented in the service <a href="#voipdialer-h-0"> (see voipdialer header file).</a></p>
<pre class="highlightedCode brush: cpp">     DialScreen {
         id: dialScreen
         property bool activeCall : false
         property variant currentDialer: 0;
         anchors.topMargin: 5
         anchors.leftMargin: 5
         anchors.rightMargin: 5
         anchors.right: parent.right
         anchors.top: parent.top
         onDial: {
             if (activeCall == false) {
                 if (dialerList.dialService != 0) {
                     var o = dialerObject;
                     status.text = &quot;Dialing &quot; + numberToDial +&quot;...&quot;;
                     dialScreen.currentDialer = o;
                     o.dialNumber(numberToDial);
                     activeCall = true;
                 }
             }
         }
         onHangup: {
             if (activeCall) {
                 if (dialScreen.currentDialer != 0) {
                     dialScreen.currentDialer.hangup();
                 }
                 status.text = &quot;Hang up&quot;;
             }
         }
     }</pre>
<p>In DialScreen.qml the dial and the hangup signals are defined. The hangup signal will be emitted if the HangUpButton was clicked:</p>
<pre class="highlightedCode brush: cpp">     DialButton {
         id: hangUpButton
         height: { (numberPad.height / 2) - 2 }
         width: 50
         anchors.top: numberPad.top
         anchors.left: numberPad.right
         anchors.leftMargin: 5
         hoverColor: &quot;red&quot;
         color: &quot;crimson&quot;
         onClicked: {
             dialString = &quot;&quot;
             hangup()
         }</pre>
<p>The dial signal will be emitted if the CallButton was clicked:</p>
<pre class="highlightedCode brush: cpp">     DialButton {
         id: callButton
         width: 50
         height: {(numberPad.height/2) -2}
         anchors.top: hangUpButton.bottom
         anchors.left: numberPad.right
         anchors.leftMargin: 5
         anchors.topMargin: 4
         color: &quot;mediumseagreen&quot;
         hoverColor: &quot;lightgreen&quot;
         onClicked: {
             if (dialString != &quot;&quot;) {
                 dial(dialString)
                 dialString = &quot;&quot;
             }
         }</pre>
<p>Now we need to connect the stateChanged signal form the services with an event handler on the QML site. This is done in our main declarative file:</p>
<pre class="highlightedCode brush: cpp">     Connections {
         target: dialerObject
         ignoreUnknownSignals: true

         onStateChanged: {
             if (dialScreen.currentDialer.state == 1) {
                 status.text += &quot;\nRinging&quot;;
             }
             else if (dialScreen.currentDialer.state == 2) {
                 status.text += &quot;\nConnected&quot;;
             }
             else if (dialScreen.currentDialer.state == 0) {
                 status.text += &quot;\nConnection terminated&quot;;
                 dialScreen.activeCall = false;
                 clearStatusTimer.running = true;
             }
             else if (dialScreen.currentDialer.state == 3) {
                 status.text += &quot;\nPhone already engaged&quot;;
             }
         }
     }</pre>
<p>The DialScreen.currentDialer is assigned during a ListView item click in the <a href="#dialerlist-qml-2"> ServiceList.qml file</a>.</p>
</div>
        <!-- /div -->
        <div class="feedback t_button">
          [+] Documentation Feedback</div>
      </div>
    </div>
    <div class="ft">
      <span></span>
    </div>
  </div> 
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2008-2010 Nokia Corporation and/or its
      subsidiaries. Nokia, Qt and their respective logos are trademarks of Nokia Corporation 
      in Finland and/or other countries worldwide.</p>
    <p>
      All other trademarks are property of their respective owners. <a title="Privacy Policy"
        href="http://qt.nokia.com/about/privacy-policy">Privacy Policy</a></p>
  </div>
  <div id="feedbackBox">
      <div id="feedcloseX" class="feedclose t_button">X</div>
    <form id="feedform" action="http://doc.qt.nokia.com/docFeedbck/feedback.php" method="get">
      <p id="noteHead">Thank you for giving your feedback.</p> <div class="note"><p>Make sure it is related to this specific page. For more general bugs and 
      requests, please use the <a href="http://bugreports.qt.nokia.com/secure/Dashboard.jspa">Qt Bug Tracker</a>.</p></div>
      <p><textarea id="feedbox" name="feedText" rows="5" cols="40"></textarea></p>
      <p><input id="feedsubmit" class="feedclose" type="submit" name="feedback" /></p>
    </form>
  </div>
  <div id="blurpage">
  </div>
  </div>
  <script src="scripts/functions.js" type="text/javascript"></script>
</body>
</html>
